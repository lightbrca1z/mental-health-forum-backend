# Railway用SQLite設定のまとめ

RailwayでSQLiteを使用するための設定ファイルを作成しました：

### 作成したファイル：
1. **`railway-sqlite-production.env`** - Railway本番環境用の環境変数設定
2. **`RAILWAY_SQLITE_SETUP.md`** - 詳細な設定手順書

### Railwayでの設定手順：

#### 1. 環境変数の設定
Railwayのダッシュボードで「Variables」タブを開き、以下の必須設定を追加：

```
APP_NAME="Mental Health Forum"
APP_ENV=production
APP_DEBUG=false
APP_URL=https://mental-health-forum-backend-production.up.railway.app

# データベース設定（SQLite）
DB_CONNECTION=sqlite
DB_DATABASE=/var/www/database/database.sqlite

# セッション設定
SESSION_DRIVER=file
SESSION_LIFETIME=120

# キャッシュ設定
CACHE_DRIVER=file

# ファイルシステム設定
FILESYSTEM_DISK=local

# ログ設定
LOG_CHANNEL=stack
LOG_LEVEL=error

# メール設定
MAIL_MAILER=smtp
MAIL_HOST=mailpit
MAIL_PORT=1025
MAIL_USERNAME=null
MAIL_PASSWORD=null
MAIL_ENCRYPTION=null
MAIL_FROM_ADDRESS="noreply@example.com"
MAIL_FROM_NAME="${APP_NAME}"

# ブロードキャスト設定
BROADCAST_DRIVER=log

# キュー設定
QUEUE_CONNECTION=sync
```

#### 2. Dockerfileの設定
Railwayの「Settings」タブで、以下のいずれかを使用：

**推奨設定:**
```
docker build -f Dockerfile.sqlite-final -t mental-health-forum-backend .
```

**簡単設定:**
```
docker build -f Dockerfile.sqlite-simple -t mental-health-forum-backend .
```

#### 3. データベース永続化（推奨）
Railwayで「New」→「Storage」を選択してストレージを作成し、環境変数に追加：
```
RAILWAY_STORAGE_MOUNT_PATH=/var/www/database
```

これらの設定により、RailwayでSQLiteを使用したアプリケーションが正常に動作するはずです。 

## 解決策

`sqlite3-dev`パッケージが見つからないエラーを解決するために、以下の3つの選択肢を提供しました：

### 選択肢1: 修正されたSQLite Dockerfile（推奨）
Railwayの設定で以下を使用：
```
docker build -f Dockerfile.sqlite-fixed -t mental-health-forum-backend .
```

### 選択肢2: Alpine Linuxベース（軽量）
```
docker build -f Dockerfile.sqlite-alpine -t mental-health-forum-backend .
```

### 選択肢3: MySQLを使用（最も確実）
```
docker build -f Dockerfile.mysql-simple -t mental-health-forum-backend .
```

## Railwayでの設定手順

1. **Railwayダッシュボード**で「Settings」タブを開く
2. **Build Command**を上記のいずれかに変更
3. **Deploy**を実行

## 推奨解決策

**最も確実な解決策は選択肢3（MySQL）を使用することです**：

1. Railwayで「New」→「Database」→「MySQL」を選択してデータベースを作成
2. 環境変数をMySQL用に変更：
   ```
   DB_CONNECTION=mysql
   DB_HOST=[MySQLプラグインから取得]
   DB_PORT=[MySQLプラグインから取得]
   DB_DATABASE=[MySQLプラグインから取得]
   DB_USERNAME=[MySQLプラグインから取得]
   DB_PASSWORD=[MySQLプラグインから取得]
   ```
3. Build Commandを以下に設定：
   ```
   docker build -f Dockerfile.mysql-simple -t mental-health-forum-backend .
   ```

これで、`sqlite3-dev`パッケージの問題が解決され、アプリケーションが正常にデプロイされるはずです。 